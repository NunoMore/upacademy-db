<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="WEB-INF/layouts/commonLayout.xhtml">

	<ui:define name="display">
	#{currentUserBean.initCurrentUser()}
		<h:form id="formTable">
			<p:dataTable id="consultAll" var="person"
				value="#{personBean.readPerson()}" widgetVar="personsTable"
				multiViewState="true" rows="10" paginator="true"
				paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				rowsPerPageTemplate="5,10,15" selectionMode="single"
				selection="#{tableView.selectedPerson}" rowKey="#{person.ID}"
				emptyMessage="No persons found with that search criteria"
				filteredValue="#{tableView.filteredPersons}">

				<f:facet name="header">
					<p:outputPanel>
						<h:outputText value="Search all fields:" />
						<p:inputText id="globalFilter"
							onkeyup="PF('personsTable').filter()" style="width:150px"
							placeholder="Search" />
					</p:outputPanel>
				</f:facet>

				<p:ajax event="rowSelect" update=":formTable:personDetail"
					oncomplete="PF('personDialog').show()" />
					
				<p:column headerText="Online/Offline">
					<p:graphicImage name="images/offline-red.png" rendered="#{person.online == false}" style="width:30px" />
					<p:graphicImage name="images/online-green.png" rendered="#{person.online == true}" style="width:30px" />
				</p:column>

				<p:column headerText="Foto">
					<p:graphicImage value="#{person.photo}" rendered="#{person.photo != null}" style="width:30px"/>
					<p:graphicImage name="images/defaultUser.png" rendered="#{person.photo == null}" style="width:30px"/>
				</p:column>

				<p:column headerText="Nome" filterBy="#{person.name}"
					sortBy="#{person.name}" filterMatchMode="startsWith">
					<h:outputText value="#{person.name}" />
				</p:column>

				<p:column headerText="Academia" filterBy="#{person.academy}"
					sortBy="#{person.academy}" filterMatchMode="exact">
					<f:facet name="filter">
						<p:selectOneMenu onchange="PF('personsTable').filter()"
							style="width:150px;">
							<f:selectItem itemLabel="Academias" itemValue="#{null}"
								noSelectionOption="true" />
							<f:selectItems value="#{AcademyService.academies}" /> <!-- falta criar academyService -->
						</p:selectOneMenu>
					</f:facet>
					<h:outputText value="#{person.academy}" />
				</p:column>
			</p:dataTable>
			<p:dialog header="#{tableView.selectedPerson.username}" widgetVar="personDialog" modal="true"
				showEffect="slide" hideEffect="explode" resizable="false">
				<p:outputPanel id="personDetail" style="text-align:center;">
					<p:panelGrid columns="2"
						rendered="#{not empty tableView.selectedPerson}">
						<f:facet name="header">
							<p:graphicImage value="#{person.photo}" rendered="#{person.photo != null}" style="width:100px"/>
							<p:graphicImage name="images/defaultUser.png" rendered="#{person.photo == null}" style="width:100px"/>
						</f:facet>

						<h:outputText value="Nome" />
						<h:outputText value="#{tableView.selectedPerson.name}" />
						
						<h:outputText value="Data de Nascimento" />
						<h:outputText value="#{tableView.selectedPerson.dateOfBirth}" />
						
						<h:outputText value="Curso" />
						<h:outputText value="#{tableView.selectedPerson.academicCourse}" />
						
						<h:outputText value="Género" />
						<h:outputText value="#{tableView.selectedPerson.gender}" />

						<h:outputText value="Telemóvel" />
						<h:outputText value="#{tableView.selectedPerson.numTelephone}" />

						<h:outputText value="Email" />
						<h:outputText value="#{tableView.selectedPerson.email}" />

						<h:outputText value="Academia" />
						<h:outputText value="#{tableView.selectedPerson.academy}" />
						
						<h:outputText value="Trabalho" />
						<h:outputText value="#{tableView.selectedPerson.workPlace}" />
						
						<h:outputText value="Curriculum" />
						<p:commandLink value="Download" >
							<p:fileDownload value="#{tableView.selectedPerson.curriculum}"/>
						</p:commandLink>

						<h:outputText value="Facebook" />
						<h:link value="#{tableView.selectedPerson.facebookLink}" />

						<h:outputText value="LinkedIn" />
						<h:link value="#{tableView.selectedPerson.linkedInLink}" />

						<h:outputText value="Git Hub" />
						<h:link value="#{tableView.selectedPerson.gitHubLink}" />
					</p:panelGrid>
				</p:outputPanel>
			</p:dialog>
		</h:form>
	</ui:define>
</ui:composition>
